---

- name: Installing Mesos dependencies
  shell: sudo apt-get install -y autoconf libtool

- name: Installing Mesos dependencies  
  apt: name={{ item }} state=present
  with_items:
   - build-essential 
   - python-dev 
   - python-boto 
   - libcurl4-nss-dev 
   - libsasl2-dev 
   - maven 
   - libapr1-dev 
   - libsvn-dev


- name: Download mesos tar
  get_url:
    url: '{{ MESOS_INSTALL_URL }}'
    dest: "/home/{{ DEPLOY_USER }}/{{ MESOS_VERSION }}.tar.gz"

- name: Exract Mesos
  shell: cd /home/hduser && tar -zxf {{ MESOS_VERSION}}.tar.gz

- name: Create directory build
  file: path=/home/hduser/mesos-{{ MESOS_VERSION }}/build state=directory mode=0755

- name: Run configure to create make file
  shell: ../configure >> configure-output.txt
  args:
    chdir: ../../home/hduser/mesos-{{ MESOS_VERSION }}/build


- name: make
  shell: make >> make-output.txt
  args:
    chdir: ../../home/hduser/mesos-{{ MESOS_VERSION}}/build

#- name: Run test suite
#  shell: make check >> make-check-output.txt
#  args:
#    chdir: ../../home/hduser/mesos-{{ MESOS_VERSION}}/build
